<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>module CommonFunctions - RDoc Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="module">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/common_functions.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    
    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-clear_app">::clear_app</a>
    
    <li><a href="#method-c-convert_fqdn_to_ip">::convert_fqdn_to_ip</a>
    
    <li><a href="#method-c-create_user">::create_user</a>
    
    <li><a href="#method-c-encrypt_password">::encrypt_password</a>
    
    <li><a href="#method-c-find_real_ssh_key">::find_real_ssh_key</a>
    
    <li><a href="#method-c-get_all_public_ips">::get_all_public_ips</a>
    
    <li><a href="#method-c-get_app_info">::get_app_info</a>
    
    <li><a href="#method-c-get_app_info_from_options">::get_app_info_from_options</a>
    
    <li><a href="#method-c-get_app_name_from_tar">::get_app_name_from_tar</a>
    
    <li><a href="#method-c-get_app_name_via_xml">::get_app_name_via_xml</a>
    
    <li><a href="#method-c-get_app_name_via_yaml">::get_app_name_via_yaml</a>
    
    <li><a href="#method-c-get_credentials">::get_credentials</a>
    
    <li><a href="#method-c-get_db_master_ip">::get_db_master_ip</a>
    
    <li><a href="#method-c-get_email">::get_email</a>
    
    <li><a href="#method-c-get_from_yaml">::get_from_yaml</a>
    
    <li><a href="#method-c-get_head_node_ip">::get_head_node_ip</a>
    
    <li><a href="#method-c-get_infrastructure">::get_infrastructure</a>
    
    <li><a href="#method-c-get_ips_from_yaml">::get_ips_from_yaml</a>
    
    <li><a href="#method-c-get_line_from_stdin_no_echo">::get_line_from_stdin_no_echo</a>
    
    <li><a href="#method-c-get_load_balancer_id">::get_load_balancer_id</a>
    
    <li><a href="#method-c-get_load_balancer_ip">::get_load_balancer_ip</a>
    
    <li><a href="#method-c-get_login_ip">::get_login_ip</a>
    
    <li><a href="#method-c-get_password">::get_password</a>
    
    <li><a href="#method-c-get_random_alphanumeric">::get_random_alphanumeric</a>
    
    <li><a href="#method-c-get_remote_appscale_home">::get_remote_appscale_home</a>
    
    <li><a href="#method-c-get_role_from_nodes">::get_role_from_nodes</a>
    
    <li><a href="#method-c-get_secret_key">::get_secret_key</a>
    
    <li><a href="#method-c-get_table">::get_table</a>
    
    <li><a href="#method-c-get_username_from_options">::get_username_from_options</a>
    
    <li><a href="#method-c-is_port_open-3F">::is_port_open?</a>
    
    <li><a href="#method-c-make_appscale_directory">::make_appscale_directory</a>
    
    <li><a href="#method-c-move_app">::move_app</a>
    
    <li><a href="#method-c-read_file">::read_file</a>
    
    <li><a href="#method-c-read_nodes_json">::read_nodes_json</a>
    
    <li><a href="#method-c-require_commands">::require_commands</a>
    
    <li><a href="#method-c-rsync_files">::rsync_files</a>
    
    <li><a href="#method-c-run_remote_command">::run_remote_command</a>
    
    <li><a href="#method-c-scp_app_to_ip">::scp_app_to_ip</a>
    
    <li><a href="#method-c-scp_file">::scp_file</a>
    
    <li><a href="#method-c-shell">::shell</a>
    
    <li><a href="#method-c-sleep_until_port_is_closed">::sleep_until_port_is_closed</a>
    
    <li><a href="#method-c-sleep_until_port_is_open">::sleep_until_port_is_open</a>
    
    <li><a href="#method-c-start_head_node">::start_head_node</a>
    
    <li><a href="#method-c-update_appcontroller">::update_appcontroller</a>
    
    <li><a href="#method-c-update_locations_file">::update_locations_file</a>
    
    <li><a href="#method-c-user_has_cmd-3F">::user_has_cmd?</a>
    
    <li><a href="#method-c-validate_app_name">::validate_app_name</a>
    
    <li><a href="#method-c-wait_for_app_to_start">::wait_for_app_to_start</a>
    
    <li><a href="#method-c-wait_for_nodes_to_load">::wait_for_nodes_to_load</a>
    
    <li><a href="#method-c-wait_until_redirect">::wait_until_redirect</a>
    
    <li><a href="#method-c-warn_on_large_app_size">::warn_on_large_app_size</a>
    
    <li><a href="#method-c-write_and_copy_node_file">::write_and_copy_node_file</a>
    
    <li><a href="#method-c-write_file">::write_file</a>
    
    <li><a href="#method-c-write_node_file">::write_node_file</a>
    
    <li><a href="#method-c-write_nodes_json">::write_nodes_json</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./lib/sshcopyid.html">sshcopyid</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./AdvancedNode.html">AdvancedNode</a>
  
    <li><a href="./AppControllerClient.html">AppControllerClient</a>
  
    <li><a href="./AppEngineConfigException.html">AppEngineConfigException</a>
  
    <li><a href="./AppScaleException.html">AppScaleException</a>
  
    <li><a href="./AppScaleTools.html">AppScaleTools</a>
  
    <li><a href="./BadCommandLineArgException.html">BadCommandLineArgException</a>
  
    <li><a href="./BadConfigurationException.html">BadConfigurationException</a>
  
    <li><a href="./CommonFunctions.html">CommonFunctions</a>
  
    <li><a href="./EncryptionHelper.html">EncryptionHelper</a>
  
    <li><a href="./GodInterface.html">GodInterface</a>
  
    <li><a href="./InfrastructureException.html">InfrastructureException</a>
  
    <li><a href="./Node.html">Node</a>
  
    <li><a href="./NodeLayout.html">NodeLayout</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./ParseArgs.html">ParseArgs</a>
  
    <li><a href="./RemoteLogging.html">RemoteLogging</a>
  
    <li><a href="./SimpleNode.html">SimpleNode</a>
  
    <li><a href="./UsageText.html">UsageText</a>
  
    <li><a href="./UserAppClient.html">UserAppClient</a>
  
    <li><a href="./VMTools.html">VMTools</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="module">module CommonFunctions</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-clear_app" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clear_app</span><span
            class="method-args">(app_path, force=false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="clear_app-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 191</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clear_app</span>(<span class="ruby-identifier">app_path</span>, <span class="ruby-identifier">force</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">app_path</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">app_path</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp">%r\A\/tmp/</span> <span class="ruby-keyword">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">force</span>
  <span class="ruby-identifier">path_to_remove</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">app_path</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_f</span>(<span class="ruby-identifier">path_to_remove</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- clear_app-source -->
          
        </div>

        

        
      </div><!-- clear_app-method -->

    
      <div id="method-c-convert_fqdn_to_ip" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">convert_fqdn_to_ip</span><span
            class="method-args">(host)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="convert_fqdn_to_ip-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 380</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">convert_fqdn_to_ip</span>(<span class="ruby-identifier">host</span>)
  <span class="ruby-identifier">nslookup</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;nslookup #{host}&quot;</span>)
  <span class="ruby-identifier">ip</span> = <span class="ruby-identifier">nslookup</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">%r#{host}\nAddress:\s+(#{IP_REGEX})/</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">ip</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">ip</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppScaleException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Couldn't convert #{host} to an IP &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-node">&quot;address. Result of nslookup was \n#{nslookup}&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">ip</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- convert_fqdn_to_ip-source -->
          
        </div>

        

        
      </div><!-- convert_fqdn_to_ip-method -->

    
      <div id="method-c-create_user" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_user</span><span
            class="method-args">(user, test, head_node_ip, secret_key, uac, pass=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="create_user-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 248</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">create_user</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">test</span>, <span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">secret_key</span>, <span class="ruby-identifier">uac</span>, <span class="ruby-identifier">pass</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">pass</span>
    <span class="ruby-identifier">pass</span> = <span class="ruby-identifier">pass</span> <span class="ruby-comment"># TODO - can we just remove this?</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">test</span>
    <span class="ruby-identifier">pass</span> = <span class="ruby-string">&quot;aaaaaa&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">pass</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_password</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">encrypted_pass</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">encrypt_password</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">pass</span>)
  <span class="ruby-identifier">uac</span>.<span class="ruby-identifier">commit_new_user</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">encrypted_pass</span>)

  <span class="ruby-identifier">login_ip</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_login_ip</span>(<span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">secret_key</span>)
 
  <span class="ruby-comment"># create xmpp account</span>
  <span class="ruby-comment"># for user a@a.a, this translates to a@login_ip</span>

  <span class="ruby-identifier">pre</span> = <span class="ruby-identifier">user</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">%r\A(.*)@/</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">xmpp_user</span> = <span class="ruby-node">&quot;#{pre}@#{login_ip}&quot;</span>
  <span class="ruby-identifier">xmpp_pass</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">encrypt_password</span>(<span class="ruby-identifier">xmpp_user</span>, <span class="ruby-identifier">pass</span>)
  <span class="ruby-identifier">uac</span>.<span class="ruby-identifier">commit_new_user</span>(<span class="ruby-identifier">xmpp_user</span>, <span class="ruby-identifier">xmpp_pass</span>)
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Your XMPP username is #{xmpp_user}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_user-source -->
          
        </div>

        

        
      </div><!-- create_user-method -->

    
      <div id="method-c-encrypt_password" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encrypt_password</span><span
            class="method-args">(user, pass)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="encrypt_password-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 391</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">encrypt_password</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">pass</span>)
  <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA1</span>.<span class="ruby-identifier">hexdigest</span>(<span class="ruby-identifier">user</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pass</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- encrypt_password-source -->
          
        </div>

        

        
      </div><!-- encrypt_password-method -->

    
      <div id="method-c-find_real_ssh_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_real_ssh_key</span><span
            class="method-args">(ssh_keys, host)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="find_real_ssh_key-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 561</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">find_real_ssh_key</span>(<span class="ruby-identifier">ssh_keys</span>, <span class="ruby-identifier">host</span>)
  <span class="ruby-identifier">ssh_keys</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">key</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">key</span>)
    <span class="ruby-identifier">return_value</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;ssh -i #{key} #{SSH_OPTIONS} 2&gt;&amp;1 root@#{host} 'touch /tmp/foo'; echo $? &quot;</span>).<span class="ruby-identifier">chomp</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">return_value</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;0&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">key</span>
    <span class="ruby-keyword">end</span>
  }
  
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppScaleException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">NO_SSH_KEY_FOUND</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- find_real_ssh_key-source -->
          
        </div>

        

        
      </div><!-- find_real_ssh_key-method -->

    
      <div id="method-c-get_all_public_ips" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_all_public_ips</span><span
            class="method-args">(keyname, required=true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_all_public_ips-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 755</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_all_public_ips</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-identifier">required</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">ips</span> = []
  <span class="ruby-identifier">nodes</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">read_nodes_json</span>(<span class="ruby-identifier">keyname</span>)
  <span class="ruby-identifier">nodes</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">ips</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">node</span>[<span class="ruby-string">'public_ip'</span>]
  }
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">ips</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_all_public_ips-source -->
          
        </div>

        

        
      </div><!-- get_all_public_ips-method -->

    
      <div id="method-c-get_app_info" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_app_info</span><span
            class="method-args">(fullpath, app_file)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_app_info-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 911</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_app_info</span>(<span class="ruby-identifier">fullpath</span>, <span class="ruby-identifier">app_file</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">fullpath</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppEngineConfigException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;AppEngine file not found&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">fullpath</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">%r\/?([\w\.]+\Z)/</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">to_s</span>

  <span class="ruby-identifier">temp_dir</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_random_alphanumeric</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-node">&quot;/tmp/#{temp_dir}&quot;</span>, <span class="ruby-value">:secure</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-node">&quot;/tmp/#{temp_dir}&quot;</span>)

  <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">move_app</span>(<span class="ruby-identifier">temp_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">app_file</span>, <span class="ruby-identifier">fullpath</span>)
  <span class="ruby-identifier">app_yaml_loc</span> = <span class="ruby-identifier">app_file</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-node">&quot;/tmp/#{temp_dir}/#{app_file}&quot;</span>)
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-node">&quot;/tmp/#{temp_dir}&quot;</span>, <span class="ruby-value">:secure</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">app_file</span> <span class="ruby-operator">==</span> <span class="ruby-constant">PYTHON_CONFIG</span>
    <span class="ruby-identifier">app_name</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_app_name_via_yaml</span>(<span class="ruby-identifier">temp_dir</span>, <span class="ruby-identifier">app_yaml_loc</span>)
    <span class="ruby-identifier">language</span> = <span class="ruby-string">&quot;python&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">fullpath</span>)
      <span class="ruby-identifier">temp_dir2</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_random_alphanumeric</span>
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-node">&quot;/tmp/#{temp_dir2}&quot;</span>, <span class="ruby-value">:secure</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>)
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-node">&quot;/tmp/#{temp_dir2}&quot;</span>)
      <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;cd /tmp/#{temp_dir}; tar -czf ../#{temp_dir2}/#{app_name}.tar.gz .&quot;</span>)
      <span class="ruby-identifier">file</span> = <span class="ruby-node">&quot;/tmp/#{temp_dir2}/#{app_name}.tar.gz&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">file</span> = <span class="ruby-identifier">fullpath</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">app_file</span> <span class="ruby-operator">==</span> <span class="ruby-constant">JAVA_CONFIG</span>
    <span class="ruby-identifier">app_name</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_app_name_via_xml</span>(<span class="ruby-identifier">temp_dir</span>, <span class="ruby-identifier">app_yaml_loc</span>)
    <span class="ruby-identifier">language</span> = <span class="ruby-string">&quot;java&quot;</span>
    <span class="ruby-comment"># don't remove user's jar files, they may have their own jars in it</span>
    <span class="ruby-comment">#FileUtils.rm_rf(&quot;/tmp/#{temp_dir}/war/WEB-INF/lib/&quot;, :secure =&gt; true)</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-node">&quot;/tmp/#{temp_dir}/war/WEB-INF/lib&quot;</span>)
    <span class="ruby-identifier">temp_dir2</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_random_alphanumeric</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-node">&quot;/tmp/#{temp_dir2}&quot;</span>, <span class="ruby-value">:secure</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>)
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-node">&quot;/tmp/#{temp_dir2}&quot;</span>)
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_f</span>(<span class="ruby-node">&quot;/tmp/#{temp_dir}/#{filename}&quot;</span>)
    <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;cd /tmp/#{temp_dir}; tar -czf ../#{temp_dir2}/#{app_name}.tar.gz .&quot;</span>)
    <span class="ruby-identifier">file</span> = <span class="ruby-node">&quot;/tmp/#{temp_dir2}/#{app_name}.tar.gz&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-node">&quot;/tmp/#{temp_dir}&quot;</span>, <span class="ruby-value">:secure</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppEngineConfigException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;app_name was #{app_file}, &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-string">&quot;which was not a recognized value.&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">app_name</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-node">&quot;/tmp/#{temp_dir}&quot;</span>, <span class="ruby-value">:secure</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppEngineConfigException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;AppEngine tar file is invalid - &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-node">&quot;Doesn't have an app name in #{app_file}&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-node">&quot;/tmp/#{temp_dir}&quot;</span>, <span class="ruby-value">:secure</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>)
  <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">warn_on_large_app_size</span>(<span class="ruby-identifier">file</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">app_name</span>, <span class="ruby-identifier">file</span>, <span class="ruby-identifier">language</span> 
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_app_info-source -->
          
        </div>

        

        
      </div><!-- get_app_info-method -->

    
      <div id="method-c-get_app_info_from_options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_app_info_from_options</span><span
            class="method-args">(options)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_app_info_from_options-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 856</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_app_info_from_options</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">file_location</span> = <span class="ruby-identifier">options</span>[<span class="ruby-string">'file_location'</span>]
  <span class="ruby-identifier">table</span> = <span class="ruby-identifier">options</span>[<span class="ruby-string">'table'</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">file_location</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">apps_to_start</span> = [<span class="ruby-string">&quot;none&quot;</span>]
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">apps_to_start</span>, {}
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">app_info</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_app_name_from_tar</span>(<span class="ruby-identifier">file_location</span>)
    <span class="ruby-identifier">apps_to_start</span> = [<span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">validate_app_name</span>(<span class="ruby-identifier">app_info</span>[<span class="ruby-value">:app_name</span>], <span class="ruby-identifier">table</span>)]
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">apps_to_start</span>, <span class="ruby-identifier">app_info</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_app_info_from_options-source -->
          
        </div>

        

        
      </div><!-- get_app_info_from_options-method -->

    
      <div id="method-c-get_app_name_from_tar" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_app_name_from_tar</span><span
            class="method-args">(fullpath)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_app_name_from_tar-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 871</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_app_name_from_tar</span>(<span class="ruby-identifier">fullpath</span>)
  <span class="ruby-identifier">app_name</span>, <span class="ruby-identifier">file</span>, <span class="ruby-identifier">language</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_app_info</span>(<span class="ruby-identifier">fullpath</span>, <span class="ruby-constant">PYTHON_CONFIG</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">app_name</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">language</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">app_name</span>, <span class="ruby-identifier">file</span>, <span class="ruby-identifier">language</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_app_info</span>(<span class="ruby-identifier">fullpath</span>, <span class="ruby-constant">JAVA_CONFIG</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">app_name</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">language</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppScaleException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">NO_CONFIG_FILE</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> {<span class="ruby-value">:app_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">app_name</span>, <span class="ruby-value">:file</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">file</span>, <span class="ruby-value">:language</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">language</span>}
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_app_name_from_tar-source -->
          
        </div>

        

        
      </div><!-- get_app_name_from_tar-method -->

    
      <div id="method-c-get_app_name_via_xml" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_app_name_via_xml</span><span
            class="method-args">(temp_dir, xml_loc)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_app_name_via_xml-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 984</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_app_name_via_xml</span>(<span class="ruby-identifier">temp_dir</span>, <span class="ruby-identifier">xml_loc</span>)
  <span class="ruby-identifier">xml_loc</span> = <span class="ruby-string">&quot;/tmp/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">temp_dir</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">xml_loc</span>
  <span class="ruby-identifier">web_xml_contents</span> = (<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">xml_loc</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span> }).<span class="ruby-identifier">chomp</span>
  <span class="ruby-identifier">app_name</span> = <span class="ruby-identifier">web_xml_contents</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">%r&lt;application&gt;([\w\d-]+)&lt;\/application&gt;/</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">app_name</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">app_name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">app_name</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_app_name_via_xml-source -->
          
        </div>

        

        
      </div><!-- get_app_name_via_xml-method -->

    
      <div id="method-c-get_app_name_via_yaml" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_app_name_via_yaml</span><span
            class="method-args">(temp_dir, app_yaml_loc)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_app_name_via_yaml-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 970</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_app_name_via_yaml</span>(<span class="ruby-identifier">temp_dir</span>, <span class="ruby-identifier">app_yaml_loc</span>)
  <span class="ruby-identifier">app_yaml_loc</span> = <span class="ruby-string">&quot;/tmp/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">temp_dir</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">app_yaml_loc</span>
  
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">tree</span> = <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">load_file</span>(<span class="ruby-identifier">app_yaml_loc</span>.<span class="ruby-identifier">chomp</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ArgumentError</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppScaleException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">MALFORMED_YAML</span>)
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">app_name</span> = <span class="ruby-constant">String</span>(<span class="ruby-identifier">tree</span>[<span class="ruby-string">&quot;application&quot;</span>])
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">app_name</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_app_name_via_yaml-source -->
          
        </div>

        

        
      </div><!-- get_app_name_via_yaml-method -->

    
      <div id="method-c-get_credentials" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_credentials</span><span
            class="method-args">(testing)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_credentials-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 239</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_credentials</span>(<span class="ruby-identifier">testing</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">testing</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">DEFAULT_USERNAME</span>, <span class="ruby-constant">DEFAULT_PASSWORD</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_email</span>, <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_password</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_credentials-source -->
          
        </div>

        

        
      </div><!-- get_credentials-method -->

    
      <div id="method-c-get_db_master_ip" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_db_master_ip</span><span
            class="method-args">(keyname, required=true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_db_master_ip-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 765</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_db_master_ip</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-identifier">required</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_role_from_nodes</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-string">'db_master'</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_db_master_ip-source -->
          
        </div>

        

        
      </div><!-- get_db_master_ip-method -->

    
      <div id="method-c-get_email" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_email</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_email-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 638</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_email</span>
  <span class="ruby-identifier">email</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;\nThis AppScale instance is linked to an e-mail address giving it administrator privileges.&quot;</span>
  
  <span class="ruby-identifier">loop</span> {
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Enter your desired administrator e-mail address: &quot;</span>
    <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">flush</span>
    <span class="ruby-identifier">email</span> = <span class="ruby-constant">STDIN</span>.<span class="ruby-identifier">gets</span>.<span class="ruby-identifier">chomp</span>
    
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">email</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EMAIL_REGEX</span>
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;The response you typed in was not an e-mail address. Please try again.\n\n&quot;</span>
    <span class="ruby-keyword">end</span>
  }
  
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">email</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_email-source -->
          
        </div>

        

        
      </div><!-- get_email-method -->

    
      <div id="method-c-get_from_yaml" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_from_yaml</span><span
            class="method-args">(keyname, tag, required=true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_from_yaml-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 696</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_from_yaml</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-identifier">tag</span>, <span class="ruby-identifier">required</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">location_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-node">&quot;~/.appscale/locations-#{keyname}.yaml&quot;</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">location_file</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppScaleException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;An AppScale instance is not currently &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-node">&quot;running with the provided keyname, \&quot;#{keyname}\&quot;.&quot;</span>)
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">tree</span> = <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">load_file</span>(<span class="ruby-identifier">location_file</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ArgumentError</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">required</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppScaleException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">MALFORMED_YAML</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">tree</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppScaleException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;The location file is in the wrong format.&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">value</span> = <span class="ruby-identifier">tree</span>[<span class="ruby-identifier">tag</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">required</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppScaleException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;The location file did not contain a #{tag} tag.&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">value</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_from_yaml-source -->
          
        </div>

        

        
      </div><!-- get_from_yaml-method -->

    
      <div id="method-c-get_head_node_ip" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_head_node_ip</span><span
            class="method-args">(keyname, required=true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_head_node_ip-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 770</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_head_node_ip</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-identifier">required</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_role_from_nodes</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-string">'shadow'</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_head_node_ip-source -->
          
        </div>

        

        
      </div><!-- get_head_node_ip-method -->

    
      <div id="method-c-get_infrastructure" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_infrastructure</span><span
            class="method-args">(keyname, required=true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_infrastructure-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 780</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_infrastructure</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-identifier">required</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_from_yaml</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-value">:infrastructure</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_infrastructure-source -->
          
        </div>

        

        
      </div><!-- get_infrastructure-method -->

    
      <div id="method-c-get_ips_from_yaml" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_ips_from_yaml</span><span
            class="method-args">(ips)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_ips_from_yaml-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 220</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_ips_from_yaml</span>(<span class="ruby-identifier">ips</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;using_tools&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ips</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">ips_to_use</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">ips</span>[<span class="ruby-value">:servers</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">ips</span>[<span class="ruby-value">:servers</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ip</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">ip</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">IP_REGEX</span>
        <span class="ruby-identifier">ips_to_use</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ip</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">ips_to_use</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">convert_fqdn_to_ip</span>(<span class="ruby-identifier">ip</span>)
      <span class="ruby-keyword">end</span>
    }
    <span class="ruby-identifier">ips_to_use</span> = <span class="ruby-identifier">ips_to_use</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;:&quot;</span>)
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">ips_to_use</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_ips_from_yaml-source -->
          
        </div>

        

        
      </div><!-- get_ips_from_yaml-method -->

    
      <div id="method-c-get_line_from_stdin_no_echo" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_line_from_stdin_no_echo</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_line_from_stdin_no_echo-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 686</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_line_from_stdin_no_echo</span>
  <span class="ruby-identifier">state</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-string">&quot;stty -g&quot;</span>)
  <span class="ruby-identifier">system</span> <span class="ruby-string">&quot;stty -echo&quot;</span> <span class="ruby-comment"># Turn off character echoing</span>
  <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">flush</span>
  <span class="ruby-identifier">line</span> = <span class="ruby-constant">STDIN</span>.<span class="ruby-identifier">gets</span>.<span class="ruby-identifier">chomp</span>
  <span class="ruby-identifier">system</span> <span class="ruby-node">&quot;stty #{state}&quot;</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">line</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_line_from_stdin_no_echo-source -->
          
        </div>

        

        
      </div><!-- get_line_from_stdin_no_echo-method -->

    
      <div id="method-c-get_load_balancer_id" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_load_balancer_id</span><span
            class="method-args">(keyname, required=true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_load_balancer_id-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 745</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_load_balancer_id</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-identifier">required</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_from_yaml</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-value">:instance_id</span>)  
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_load_balancer_id-source -->
          
        </div>

        

        
      </div><!-- get_load_balancer_id-method -->

    
      <div id="method-c-get_load_balancer_ip" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_load_balancer_ip</span><span
            class="method-args">(keyname, required=true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_load_balancer_ip-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 740</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_load_balancer_ip</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-identifier">required</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_role_from_nodes</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-string">'load_balancer'</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_load_balancer_ip-source -->
          
        </div>

        

        
      </div><!-- get_load_balancer_ip-method -->

    
      <div id="method-c-get_login_ip" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_login_ip</span><span
            class="method-args">(head_node_ip, secret_key)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_login_ip-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 177</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_login_ip</span>(<span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">secret_key</span>)
  <span class="ruby-identifier">acc</span> = <span class="ruby-constant">AppControllerClient</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">secret_key</span>)
  <span class="ruby-identifier">all_nodes</span> = <span class="ruby-identifier">acc</span>.<span class="ruby-identifier">get_all_public_ips</span>()
  
  <span class="ruby-identifier">all_nodes</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">acc_new</span> = <span class="ruby-constant">AppControllerClient</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">node</span>, <span class="ruby-identifier">secret_key</span>)
    <span class="ruby-identifier">roles</span> = <span class="ruby-identifier">acc_new</span>.<span class="ruby-identifier">status</span>()
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">node</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">roles</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">%rIs currently:(.*)login/</span>)
  }

  <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppScaleException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;Unable to find login ip address!&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_login_ip-source -->
          
        </div>

        

        
      </div><!-- get_login_ip-method -->

    
      <div id="method-c-get_password" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_password</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_password-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 658</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_password</span>()
  <span class="ruby-identifier">pass</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;\nThe new administrator password must be at least six characters long and can include non-alphanumeric characters.&quot;</span>
  
  <span class="ruby-identifier">loop</span> {
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Enter your new password: &quot;</span>
    <span class="ruby-identifier">new_pass</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_line_from_stdin_no_echo</span>()
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;\nEnter again to verify: &quot;</span>
    <span class="ruby-identifier">verify_pass</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_line_from_stdin_no_echo</span>()
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;\n&quot;</span>
    
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">new_pass</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">verify_pass</span>
      <span class="ruby-identifier">pass</span> = <span class="ruby-identifier">new_pass</span>
      
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">pass</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">PASSWORD_REGEX</span>
        <span class="ruby-keyword">break</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;\n\nThe password you typed in was not at least six characters long. Please try again.\n\n&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;\n\nPasswords entered do not match. Please try again.\n\n&quot;</span>
    <span class="ruby-keyword">end</span>
  }
  
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">pass</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_password-source -->
          
        </div>

        

        
      </div><!-- get_password-method -->

    
      <div id="method-c-get_random_alphanumeric" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_random_alphanumeric</span><span
            class="method-args">(length=10)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_random_alphanumeric-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 843</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_random_alphanumeric</span>(<span class="ruby-identifier">length</span>=<span class="ruby-value">10</span>)
  <span class="ruby-identifier">random</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">possible</span> = <span class="ruby-string">&quot;0123456789abcdefghijklmnopqrstuvxwyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
  <span class="ruby-identifier">possibleLength</span> = <span class="ruby-identifier">possible</span>.<span class="ruby-identifier">length</span>

  <span class="ruby-identifier">length</span>.<span class="ruby-identifier">times</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">random</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">possible</span>[<span class="ruby-identifier">rand</span>(<span class="ruby-identifier">possibleLength</span>)]
  }

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">random</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_random_alphanumeric-source -->
          
        </div>

        

        
      </div><!-- get_random_alphanumeric-method -->

    
      <div id="method-c-get_remote_appscale_home" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_remote_appscale_home</span><span
            class="method-args">(ip, key)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_remote_appscale_home-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 462</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_remote_appscale_home</span>(<span class="ruby-identifier">ip</span>, <span class="ruby-identifier">key</span>)
  <span class="ruby-identifier">cat</span> = <span class="ruby-string">&quot;cat /etc/appscale/home&quot;</span>
  <span class="ruby-identifier">remote_cmd</span> = <span class="ruby-node">&quot;ssh -i #{key} #{SSH_OPTIONS} 2&gt;&amp;1 root@#{ip} '#{cat}'&quot;</span>
  <span class="ruby-identifier">possible_home</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;#{remote_cmd}&quot;</span>).<span class="ruby-identifier">chomp</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">possible_home</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">possible_home</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;/root/appscale/&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">possible_home</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_remote_appscale_home-source -->
          
        </div>

        

        
      </div><!-- get_remote_appscale_home-method -->

    
      <div id="method-c-get_role_from_nodes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_role_from_nodes</span><span
            class="method-args">(keyname, role)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_role_from_nodes-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 728</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_role_from_nodes</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-identifier">role</span>)
  <span class="ruby-identifier">nodes</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">read_nodes_json</span>(<span class="ruby-identifier">keyname</span>)
  <span class="ruby-identifier">nodes</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span>[<span class="ruby-string">'jobs'</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">role</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">node</span>[<span class="ruby-string">'public_ip'</span>]
    <span class="ruby-keyword">end</span>
  }

  <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_role_from_nodes-source -->
          
        </div>

        

        
      </div><!-- get_role_from_nodes-method -->

    
      <div id="method-c-get_secret_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_secret_key</span><span
            class="method-args">(keyname, required=true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_secret_key-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 775</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_secret_key</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-identifier">required</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_from_yaml</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-value">:secret</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_secret_key-source -->
          
        </div>

        

        
      </div><!-- get_secret_key-method -->

    
      <div id="method-c-get_table" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_table</span><span
            class="method-args">(keyname, required=true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_table-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 750</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_table</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-identifier">required</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_from_yaml</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-value">:table</span>, <span class="ruby-identifier">required</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_table-source -->
          
        </div>

        

        
      </div><!-- get_table-method -->

    
      <div id="method-c-get_username_from_options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_username_from_options</span><span
            class="method-args">(options)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_username_from_options-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 627</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_username_from_options</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-string">'test'</span>]
    <span class="ruby-keyword">return</span> <span class="ruby-constant">DEFAULT_USERNAME</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">options</span>[<span class="ruby-string">'email'</span>]
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">options</span>[<span class="ruby-string">'email'</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">get_email</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_username_from_options-source -->
          
        </div>

        

        
      </div><!-- get_username_from_options-method -->

    
      <div id="method-c-is_port_open-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_port_open?</span><span
            class="method-args">(ip, port, use_ssl=false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="is_port_open-3F-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 412</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_port_open?</span>(<span class="ruby-identifier">ip</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">use_ssl</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-identifier">timeout</span>(<span class="ruby-value">1</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-keyword">begin</span>
        <span class="ruby-identifier">sock</span> = <span class="ruby-constant">TCPSocket</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">ip</span>, <span class="ruby-identifier">port</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">use_ssl</span>
          <span class="ruby-identifier">ssl_context</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSLContext</span>.<span class="ruby-identifier">new</span>() 
          <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ssl_context</span>.<span class="ruby-identifier">verify_mode</span> 
            <span class="ruby-identifier">ssl_context</span>.<span class="ruby-identifier">verify_mode</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">VERIFY_NONE</span> 
          <span class="ruby-keyword">end</span> 
          <span class="ruby-identifier">sslsocket</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSLSocket</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">sock</span>, <span class="ruby-identifier">ssl_context</span>) 
          <span class="ruby-identifier">sslsocket</span>.<span class="ruby-identifier">sync_close</span> = <span class="ruby-keyword">true</span> 
          <span class="ruby-identifier">sslsocket</span>.<span class="ruby-identifier">connect</span>          
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">sock</span>.<span class="ruby-identifier">close</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- is_port_open-3F-source -->
          
        </div>

        

        
      </div><!-- is_port_open-3F-method -->

    
      <div id="method-c-make_appscale_directory" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">make_appscale_directory</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="make_appscale_directory-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 785</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">make_appscale_directory</span>()
  <span class="ruby-comment"># AppScale generates private keys for each cloud that machines are </span>
  <span class="ruby-comment"># running in. It stores this data (and a YAML file detailing IP address </span>
  <span class="ruby-comment"># mappings) in ~/.appscale - create this location if it doesn't exist.</span>
  <span class="ruby-identifier">appscale_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-string">&quot;~/.appscale&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">appscale_path</span>)
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-identifier">appscale_path</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- make_appscale_directory-source -->
          
        </div>

        

        
      </div><!-- make_appscale_directory-method -->

    
      <div id="method-c-move_app" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">move_app</span><span
            class="method-args">(temp_dir, filename, app_file, fullpath)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="move_app-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 886</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">move_app</span>(<span class="ruby-identifier">temp_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">app_file</span>, <span class="ruby-identifier">fullpath</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">fullpath</span>)
    <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;cp -r #{fullpath}/* /tmp/#{temp_dir}/&quot;</span>)
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp</span>(<span class="ruby-identifier">fullpath</span>, <span class="ruby-node">&quot;/tmp/#{temp_dir}/#{filename}&quot;</span>)
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_f</span>(<span class="ruby-node">&quot;/tmp/#{temp_dir}/#{app_file}&quot;</span>)
    <span class="ruby-identifier">tar_file</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;cd /tmp/#{temp_dir}; tar zxvfm #{filename} 2&gt;&amp;1; echo $?&quot;</span>).<span class="ruby-identifier">chomp</span>
    <span class="ruby-identifier">tar_ret_val</span> = <span class="ruby-identifier">tar_file</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">%r\d+\Z/</span>).<span class="ruby-identifier">to_s</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">tar_ret_val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;0&quot;</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppScaleException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;Untar'ing the given tar file in /tmp failed&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- move_app-source -->
          
        </div>

        

        
      </div><!-- move_app-method -->

    
      <div id="method-c-read_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">read_file</span><span
            class="method-args">(location, chomp=true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>A convenience function that returns a file’s contents as a string.</p>
          

          
          <div class="method-source-code" id="read_file-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 91</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">read_file</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">chomp</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">location</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span> }
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">chomp</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">chomp</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">file</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- read_file-source -->
          
        </div>

        

        
      </div><!-- read_file-method -->

    
      <div id="method-c-read_nodes_json" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">read_nodes_json</span><span
            class="method-args">(keyname)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Reads the JSON file that stores information about which roles run on which
nodes.</p>
          

          
          <div class="method-source-code" id="read_nodes_json-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 798</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">read_nodes_json</span>(<span class="ruby-identifier">keyname</span>)
  <span class="ruby-identifier">filename</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-node">&quot;~/.appscale/locations-#{keyname}.json&quot;</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">load</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">read_file</span>(<span class="ruby-identifier">filename</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- read_nodes_json-source -->
          
        </div>

        

        
      </div><!-- read_nodes_json-method -->

    
      <div id="method-c-require_commands" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">require_commands</span><span
            class="method-args">(commands)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="require_commands-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 369</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">require_commands</span>(<span class="ruby-identifier">commands</span>)
  <span class="ruby-identifier">commands</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cmd</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">user_has_cmd?</span>(<span class="ruby-identifier">cmd</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadConfigurationException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;You do not have the '#{cmd}' &quot;</span> <span class="ruby-operator">+</span>
        <span class="ruby-string">&quot;command in your PATH. Please ensure that it is in your path and &quot;</span> <span class="ruby-operator">+</span>
        <span class="ruby-string">&quot;try again.&quot;</span>)
    <span class="ruby-keyword">end</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- require_commands-source -->
          
        </div>

        

        
      </div><!-- require_commands-method -->

    
      <div id="method-c-rsync_files" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rsync_files</span><span
            class="method-args">(dest_ip, ssh_key, local)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Uses rsync to copy over a copy of the AppScale main codebase (e.g., not the
AppScale Tools) from this machine to a remote machine. TODO(cgb): This
function doesn’t copy files in the main directory, like the firewall
rules. It should be changed accordingly.</p>
          

          
          <div class="method-source-code" id="rsync_files-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 113</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">rsync_files</span>(<span class="ruby-identifier">dest_ip</span>, <span class="ruby-identifier">ssh_key</span>, <span class="ruby-identifier">local</span>)
  <span class="ruby-identifier">local</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">local</span>)
  <span class="ruby-identifier">controller</span> = <span class="ruby-node">&quot;#{local}/AppController&quot;</span>
  <span class="ruby-identifier">server</span> = <span class="ruby-node">&quot;#{local}/AppServer&quot;</span>
  <span class="ruby-identifier">loadbalancer</span> = <span class="ruby-node">&quot;#{local}/AppLoadBalancer&quot;</span>
  <span class="ruby-identifier">monitoring</span> = <span class="ruby-node">&quot;#{local}/AppMonitoring&quot;</span>
  <span class="ruby-identifier">appdb</span> = <span class="ruby-node">&quot;#{local}/AppDB&quot;</span>
  <span class="ruby-identifier">neptune</span> = <span class="ruby-node">&quot;#{local}/Neptune&quot;</span>
  <span class="ruby-identifier">loki</span> = <span class="ruby-node">&quot;#{local}/Loki&quot;</span>
  <span class="ruby-identifier">iaas_manager</span> = <span class="ruby-node">&quot;#{local}/InfrastructureManager&quot;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">controller</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">BadConfigurationException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;The location you &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-node">&quot;specified to rsync from, #{local}, doesn't exist or contain &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-string">&quot;AppScale data.&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;rsync -e 'ssh -i #{ssh_key}' -arv #{controller}/* root@#{dest_ip}:/root/appscale/AppController&quot;</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;rsync -e 'ssh -i #{ssh_key}' -arv #{server}/* root@#{dest_ip}:/root/appscale/AppServer&quot;</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;rsync -e 'ssh -i #{ssh_key}' -arv #{loadbalancer}/* root@#{dest_ip}:/root/appscale/AppLoadBalancer&quot;</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;rsync -e 'ssh -i #{ssh_key}' -arv #{monitoring}/* root@#{dest_ip}:/root/appscale/AppMonitoring&quot;</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;rsync -e 'ssh -i #{ssh_key}' -arv --exclude='logs/*' --exclude='hadoop-*' --exclude='hbase/hbase-*' --exclude='voldemort/voldemort/*' --exclude='cassandra/cassandra/*' #{appdb}/* root@#{dest_ip}:/root/appscale/AppDB&quot;</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;rsync -e 'ssh -i #{ssh_key}' -arv #{neptune}/* root@#{dest_ip}:/root/appscale/Neptune&quot;</span>)
  <span class="ruby-comment">#self.shell(&quot;rsync -e 'ssh -i #{ssh_key}' -arv #{loki}/* root@#{dest_ip}:/root/appscale/Loki&quot;)</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;rsync -e 'ssh -i #{ssh_key}' -arv #{iaas_manager}/* root@#{dest_ip}:/root/appscale/InfrastructureManager&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- rsync_files-source -->
          
        </div>

        

        
      </div><!-- rsync_files-method -->

    
      <div id="method-c-run_remote_command" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run_remote_command</span><span
            class="method-args">(ip, command, public_key_loc, want_output)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="run_remote_command-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 439</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">run_remote_command</span>(<span class="ruby-identifier">ip</span>, <span class="ruby-identifier">command</span>, <span class="ruby-identifier">public_key_loc</span>, <span class="ruby-identifier">want_output</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">public_key_loc</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Array</span>
    <span class="ruby-identifier">public_key_loc</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">key</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">key</span>)
    }

    <span class="ruby-identifier">remote_cmd</span> = <span class="ruby-node">&quot;ssh -i #{public_key_loc.join(' -i ')} #{SSH_OPTIONS} 2&gt;&amp;1 root@#{ip} '#{command}&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">public_key_loc</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">public_key_loc</span>)
    <span class="ruby-identifier">remote_cmd</span> = <span class="ruby-node">&quot;ssh -i #{public_key_loc} #{SSH_OPTIONS} root@#{ip} '#{command} &quot;</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">want_output</span>
    <span class="ruby-identifier">remote_cmd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&gt; /tmp/#{ip}.log 2&gt;&amp;1 &amp;' &amp;&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">remote_cmd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&gt; /dev/null 2&gt;&amp;1 &amp;' &amp;&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">system</span> <span class="ruby-identifier">remote_cmd</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">remote_cmd</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- run_remote_command-source -->
          
        </div>

        

        
      </div><!-- run_remote_command-method -->

    
      <div id="method-c-scp_app_to_ip" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">scp_app_to_ip</span><span
            class="method-args">(app_name, user, language, keyname, head_node_ip, file_location, uac)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="scp_app_to_ip-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 273</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">scp_app_to_ip</span>(<span class="ruby-identifier">app_name</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">language</span>, <span class="ruby-identifier">keyname</span>, <span class="ruby-identifier">head_node_ip</span>,
  <span class="ruby-identifier">file_location</span>, <span class="ruby-identifier">uac</span>)

  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Uploading #{app_name}...&quot;</span>
  <span class="ruby-identifier">uac</span>.<span class="ruby-identifier">commit_new_app_name</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">app_name</span>, <span class="ruby-identifier">language</span>)

  <span class="ruby-identifier">local_file_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">file_location</span>)

  <span class="ruby-identifier">app_dir</span> = <span class="ruby-node">&quot;/var/apps/#{app_name}/app&quot;</span>
  <span class="ruby-identifier">remote_file_path</span> = <span class="ruby-node">&quot;#{app_dir}/#{app_name}.tar.gz&quot;</span>
  <span class="ruby-identifier">make_app_dir</span> = <span class="ruby-node">&quot;mkdir -p #{app_dir}&quot;</span>
  <span class="ruby-identifier">true_key</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-node">&quot;~/.appscale/#{keyname}.key&quot;</span>)
  
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Creating remote directory to copy app into&quot;</span>
  <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">run_remote_command</span>(<span class="ruby-identifier">head_node_ip</span>,
    <span class="ruby-identifier">make_app_dir</span>, <span class="ruby-identifier">true_key</span>, <span class="ruby-keyword">false</span>)
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span>(<span class="ruby-value">1</span>)
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Copying over app&quot;</span>
  <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">scp_file</span>(<span class="ruby-identifier">local_file_path</span>, <span class="ruby-identifier">remote_file_path</span>,
    <span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">true_key</span>)

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">remote_file_path</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- scp_app_to_ip-source -->
          
        </div>

        

        
      </div><!-- scp_app_to_ip-method -->

    
      <div id="method-c-scp_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">scp_file</span><span
            class="method-args">(local_file_loc, remote_file_loc, target_ip, public_key_loc)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="scp_file-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 574</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">scp_file</span>(<span class="ruby-identifier">local_file_loc</span>, <span class="ruby-identifier">remote_file_loc</span>, <span class="ruby-identifier">target_ip</span>, <span class="ruby-identifier">public_key_loc</span>)
  <span class="ruby-identifier">cmd</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">local_file_loc</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">local_file_loc</span>)
  <span class="ruby-identifier">retval_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-node">&quot;~/.appscale/retval-#{rand()}&quot;</span>)
 
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">public_key_loc</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Array</span>
    <span class="ruby-identifier">public_key_loc</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">key</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">key</span>)
    }
    
    <span class="ruby-identifier">cmd</span> = <span class="ruby-node">&quot;scp -i #{public_key_loc.join(' -i ')} #{SSH_OPTIONS} 2&gt;&amp;1 #{local_file_loc} root@#{target_ip}:#{remote_file_loc}&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">public_key_loc</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">public_key_loc</span>)
    <span class="ruby-identifier">cmd</span> = <span class="ruby-node">&quot;scp -i #{public_key_loc} #{SSH_OPTIONS} 2&gt;&amp;1 #{local_file_loc} root@#{target_ip}:#{remote_file_loc}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">cmd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;; echo $? &gt; #{retval_file}&quot;</span>

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_f</span>(<span class="ruby-identifier">retval_file</span>)

  <span class="ruby-keyword">begin</span>
    <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-identifier">timeout</span>(<span class="ruby-constant">INFINITY</span>) { <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;#{cmd}&quot;</span>) }
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppScaleException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;Remotely copying over files failed. Is &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-string">&quot;the destination machine on and reachable from this computer? We &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-node">&quot;tried the following command:\n\n#{cmd}&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">loop</span> {
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">retval_file</span>)
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span>(<span class="ruby-value">5</span>)
  }

  <span class="ruby-identifier">retval</span> = (<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">retval_file</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span> }).<span class="ruby-identifier">chomp</span>

  <span class="ruby-identifier">fails</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">loop</span> {
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">retval</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;0&quot;</span>
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;\n\n[#{cmd}] returned #{retval} instead of 0 as expected. Will try to copy again momentarily...&quot;</span>
    <span class="ruby-identifier">fails</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">fails</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">5</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppScaleException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;SCP failed&quot;</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span>(<span class="ruby-value">1</span>)
    <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;#{cmd}&quot;</span>)
    <span class="ruby-identifier">retval</span> = (<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">retval_file</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span> }).<span class="ruby-identifier">chomp</span>
  }

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_f</span>(<span class="ruby-identifier">retval_file</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">cmd</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- scp_file-source -->
          
        </div>

        

        
      </div><!-- scp_file-method -->

    
      <div id="method-c-shell" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shell</span><span
            class="method-args">(command)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>cgb: added in shell function for backticks so that we can unit test it
Flexmock doesn’t like backticks since its name is non-alphanumeric e.g.,
its name is Kernel:`</p>
          

          
          <div class="method-source-code" id="shell-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 104</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-identifier">command</span>)
  <span class="ruby-node">%x#{command}`</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- shell-source -->
          
        </div>

        

        
      </div><!-- shell-method -->

    
      <div id="method-c-sleep_until_port_is_closed" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sleep_until_port_is_closed</span><span
            class="method-args">(ip, port, use_ssl=false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="sleep_until_port_is_closed-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 404</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sleep_until_port_is_closed</span>(<span class="ruby-identifier">ip</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">use_ssl</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">loop</span> {
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">is_port_open?</span>(<span class="ruby-identifier">ip</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">use_ssl</span>)
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span>(<span class="ruby-value">1</span>)
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- sleep_until_port_is_closed-source -->
          
        </div>

        

        
      </div><!-- sleep_until_port_is_closed-method -->

    
      <div id="method-c-sleep_until_port_is_open" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sleep_until_port_is_open</span><span
            class="method-args">(ip, port, use_ssl=false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="sleep_until_port_is_open-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 396</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sleep_until_port_is_open</span>(<span class="ruby-identifier">ip</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">use_ssl</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">loop</span> {
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">is_port_open?</span>(<span class="ruby-identifier">ip</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">use_ssl</span>)
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span>(<span class="ruby-value">1</span>)
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- sleep_until_port_is_open-source -->
          
        </div>

        

        
      </div><!-- sleep_until_port_is_open-method -->

    
      <div id="method-c-start_head_node" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">start_head_node</span><span
            class="method-args">(options, node_layout, apps_to_start)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="start_head_node-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 474</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">start_head_node</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">node_layout</span>, <span class="ruby-identifier">apps_to_start</span>)
  <span class="ruby-comment"># since we changed the key's name sometimes it works with storing the key</span>
  <span class="ruby-comment"># in ssh.key and sometimes it needs to be in keyname.key{.private}</span>
  <span class="ruby-comment"># always do both just in case</span>

  <span class="ruby-comment"># TODO: check here to make sure that if hybrid, the keyname is free</span>
  <span class="ruby-comment"># in all clouds specified</span>

  <span class="ruby-identifier">keyname</span> = <span class="ruby-identifier">options</span>[<span class="ruby-string">'keyname'</span>]
  <span class="ruby-identifier">named_key_loc</span> = <span class="ruby-node">&quot;~/.appscale/#{keyname}.key&quot;</span>
  <span class="ruby-identifier">named_backup_key_loc</span> = <span class="ruby-node">&quot;~/.appscale/#{keyname}.private&quot;</span>
  <span class="ruby-identifier">ssh_key_location</span> = <span class="ruby-identifier">named_key_loc</span>
  <span class="ruby-identifier">ssh_keys</span> = [<span class="ruby-identifier">ssh_key_location</span>, <span class="ruby-identifier">named_key_loc</span>, <span class="ruby-identifier">named_backup_key_loc</span>]
  <span class="ruby-identifier">secret_key</span>, <span class="ruby-identifier">secret_key_location</span> = <span class="ruby-constant">EncryptionHelper</span>.<span class="ruby-identifier">generate_secret_key</span>(<span class="ruby-identifier">keyname</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span>(<span class="ruby-node">&quot;New secret key is #{CommonFunctions.obscure_string(secret_key)}&quot;</span>, <span class="ruby-identifier">options</span>[<span class="ruby-string">'verbose'</span>])

  <span class="ruby-comment"># TODO: serialize via json instead of this hacky way</span>
  <span class="ruby-identifier">ips_hash</span> = <span class="ruby-identifier">node_layout</span>.<span class="ruby-identifier">to_hash</span>
  <span class="ruby-identifier">ips_to_use</span> = <span class="ruby-identifier">ips_hash</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">node</span>,<span class="ruby-identifier">roles</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{node}--#{roles}&quot;</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;..&quot;</span>)
   
  <span class="ruby-identifier">head_node</span> = <span class="ruby-identifier">node_layout</span>.<span class="ruby-identifier">head_node</span>
  <span class="ruby-identifier">infrastructure</span> = <span class="ruby-identifier">options</span>[<span class="ruby-string">'infrastructure'</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">infrastructure</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;hybrid&quot;</span>   
    <span class="ruby-identifier">head_node_infra</span> = <span class="ruby-constant">VMTools</span>.<span class="ruby-identifier">lookup_cloud_env</span>(<span class="ruby-identifier">head_node</span>.<span class="ruby-identifier">cloud</span>)
    <span class="ruby-constant">VMTools</span>.<span class="ruby-identifier">set_hybrid_creds</span>(<span class="ruby-identifier">node_layout</span>)
    <span class="ruby-identifier">machine</span> = <span class="ruby-constant">VMTools</span>.<span class="ruby-identifier">get_hybrid_machine</span>(<span class="ruby-identifier">head_node_infra</span>, <span class="ruby-string">&quot;1&quot;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">head_node_infra</span> = <span class="ruby-identifier">infrastructure</span>
    <span class="ruby-identifier">machine</span> = <span class="ruby-identifier">options</span>[<span class="ruby-string">'machine'</span>]
  <span class="ruby-keyword">end</span>
   
  <span class="ruby-identifier">locations</span> = <span class="ruby-constant">VMTools</span>.<span class="ruby-identifier">spawn_head_node</span>(<span class="ruby-identifier">head_node</span>, <span class="ruby-identifier">head_node_infra</span>, <span class="ruby-identifier">keyname</span>,
    <span class="ruby-identifier">ssh_key_location</span>, <span class="ruby-identifier">ssh_keys</span>, <span class="ruby-identifier">options</span>[<span class="ruby-string">'force'</span>], <span class="ruby-identifier">machine</span>,
    <span class="ruby-identifier">options</span>[<span class="ruby-string">'instance_type'</span>], <span class="ruby-identifier">options</span>[<span class="ruby-string">'group'</span>], <span class="ruby-identifier">options</span>[<span class="ruby-string">'verbose'</span>])
 
  <span class="ruby-identifier">head_node_ip</span> = <span class="ruby-identifier">locations</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;:&quot;</span>)[<span class="ruby-value">0</span>]
  <span class="ruby-identifier">instance_id</span> = <span class="ruby-identifier">locations</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">%ri-\w+/</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">locations</span> = [<span class="ruby-identifier">locations</span>]
 
  <span class="ruby-identifier">true_key</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">find_real_ssh_key</span>(<span class="ruby-identifier">ssh_keys</span>, <span class="ruby-identifier">head_node_ip</span>)
 
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span>(<span class="ruby-node">&quot;Log in to your head node: ssh -i #{true_key} &quot;</span> <span class="ruby-operator">+</span>
    <span class="ruby-node">&quot;root@#{head_node_ip}&quot;</span>, <span class="ruby-identifier">options</span>[<span class="ruby-string">'verbose'</span>])
 
  <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">ensure_image_is_appscale</span>(<span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">true_key</span>)
  <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">ensure_db_is_supported</span>(<span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">options</span>[<span class="ruby-string">'table'</span>],
    <span class="ruby-identifier">true_key</span>)
 
  <span class="ruby-identifier">scp</span> = <span class="ruby-identifier">options</span>[<span class="ruby-string">'scp'</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">scp</span>
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Copying over local copy of AppScale from #{scp}&quot;</span>
    <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">rsync_files</span>(<span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">true_key</span>, <span class="ruby-identifier">scp</span>)
  <span class="ruby-keyword">end</span>
 
  <span class="ruby-identifier">keypath</span> = <span class="ruby-identifier">true_key</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">%r([\d|\w|\.]+)\Z/</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">remote_key_location</span> = <span class="ruby-node">&quot;/root/.appscale/#{keyname}.key&quot;</span>
  <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">scp_file</span>(<span class="ruby-identifier">true_key</span>, <span class="ruby-identifier">remote_key_location</span>, <span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">true_key</span>)
 
  <span class="ruby-identifier">creds</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">generate_appscale_credentials</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">node_layout</span>,
    <span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">ips_to_use</span>, <span class="ruby-identifier">true_key</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span>(<span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">obscure_creds</span>(<span class="ruby-identifier">creds</span>).<span class="ruby-identifier">inspect</span>, <span class="ruby-identifier">options</span>[<span class="ruby-string">'verbose'</span>])
 
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Head node successfully created at #{head_node_ip}. It is now &quot;</span> <span class="ruby-operator">+</span>
    <span class="ruby-node">&quot;starting up #{options['table']} via the command line arguments given.&quot;</span>
 
  <span class="ruby-constant">RemoteLogging</span>.<span class="ruby-identifier">remote_post</span>(<span class="ruby-identifier">options</span>[<span class="ruby-string">'max_images'</span>], <span class="ruby-identifier">options</span>[<span class="ruby-string">'table'</span>],
    <span class="ruby-identifier">infrastructure</span>, <span class="ruby-string">&quot;started headnode&quot;</span>, <span class="ruby-string">&quot;success&quot;</span>)
 
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span>(<span class="ruby-value">10</span>) <span class="ruby-comment"># sometimes this helps out with ec2 / euca deployments</span>
    <span class="ruby-comment"># gives them an extra moment to come up and accept scp requests</span>
 
  <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">copy_keys</span>(<span class="ruby-identifier">secret_key_location</span>, <span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">true_key</span>,
    <span class="ruby-identifier">options</span>)
 
  <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">start_appcontroller</span>(<span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">true_key</span>,
    <span class="ruby-identifier">options</span>[<span class="ruby-string">'verbose'</span>])
 
  <span class="ruby-identifier">acc</span> = <span class="ruby-constant">AppControllerClient</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">secret_key</span>)
  <span class="ruby-identifier">creds</span> = <span class="ruby-identifier">creds</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">flatten</span>
  <span class="ruby-identifier">acc</span>.<span class="ruby-identifier">set_parameters</span>(<span class="ruby-identifier">locations</span>, <span class="ruby-identifier">creds</span>, <span class="ruby-identifier">apps_to_start</span>)

  <span class="ruby-keyword">return</span> {<span class="ruby-value">:acc</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">acc</span>, <span class="ruby-value">:head_node_ip</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">head_node_ip</span>,
    <span class="ruby-value">:instance_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">instance_id</span>, <span class="ruby-value">:true_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">true_key</span>,
    <span class="ruby-value">:secret_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">secret_key</span>}
<span class="ruby-keyword">end</span></pre>
          </div><!-- start_head_node-source -->
          
        </div>

        

        
      </div><!-- start_head_node-method -->

    
      <div id="method-c-update_appcontroller" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_appcontroller</span><span
            class="method-args">(head_node_ip, secret, app_name, remote_file_path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="update_appcontroller-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 298</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">update_appcontroller</span>(<span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">secret</span>, <span class="ruby-identifier">app_name</span>,
  <span class="ruby-identifier">remote_file_path</span>)

  <span class="ruby-identifier">acc</span> = <span class="ruby-constant">AppControllerClient</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">secret</span>)
  <span class="ruby-identifier">acc</span>.<span class="ruby-identifier">done_uploading</span>(<span class="ruby-identifier">app_name</span>, <span class="ruby-identifier">remote_file_path</span>)
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Updating AppController&quot;</span>
  <span class="ruby-identifier">acc</span>.<span class="ruby-identifier">update</span>([<span class="ruby-identifier">app_name</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_appcontroller-source -->
          
        </div>

        

        
      </div><!-- update_appcontroller-method -->

    
      <div id="method-c-update_locations_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_locations_file</span><span
            class="method-args">(keyname, ips=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>This function tries to contact a node in the AppScale deployment to get the
most up-to-date information on the current state of the deployment (as the
number of nodes could change, or the roles that nodes have taken on).</p>
          

          
          <div class="method-source-code" id="update_locations_file-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 145</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">update_locations_file</span>(<span class="ruby-identifier">keyname</span>, <span class="ruby-identifier">ips</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">secret</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_secret_key</span>(<span class="ruby-identifier">keyname</span>)

  <span class="ruby-comment"># Don't worry about prioritizing the Shadow over any other nodes,</span>
  <span class="ruby-comment"># as all nodes should be checking ZooKeeper and keeping themselves</span>
  <span class="ruby-comment"># up-to-date already.</span>
  <span class="ruby-identifier">new_role_info</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">ips</span>
    <span class="ruby-identifier">all_ips</span> = <span class="ruby-identifier">ips</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">all_ips</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_all_public_ips</span>(<span class="ruby-identifier">keyname</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">all_ips</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ip</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">acc</span> = <span class="ruby-constant">AppControllerClient</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">ip</span>, <span class="ruby-identifier">secret</span>)
      <span class="ruby-identifier">new_role_info</span> = <span class="ruby-identifier">acc</span>.<span class="ruby-identifier">get_role_info</span>()
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>
      <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;Couldn't contact AppController at #{ip}, skipping...&quot;</span>)
    <span class="ruby-keyword">end</span>
  }

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">new_role_info</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">abort</span>(<span class="ruby-string">&quot;Couldn't contact any AppControllers - is AppScale running?&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">write_nodes_json</span>(<span class="ruby-identifier">new_role_info</span>, <span class="ruby-identifier">keyname</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_locations_file-source -->
          
        </div>

        

        
      </div><!-- update_locations_file-method -->

    
      <div id="method-c-user_has_cmd-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">user_has_cmd?</span><span
            class="method-args">(command)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="user_has_cmd-3F-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 359</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_has_cmd?</span>(<span class="ruby-identifier">command</span>)
  <span class="ruby-identifier">output</span> = <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-node">&quot;which #{command}&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">output</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- user_has_cmd-3F-source -->
          
        </div>

        

        
      </div><!-- user_has_cmd-3F-method -->

    
      <div id="method-c-validate_app_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validate_app_name</span><span
            class="method-args">(app_name, database)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="validate_app_name-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 199</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">validate_app_name</span>(<span class="ruby-identifier">app_name</span>, <span class="ruby-identifier">database</span>)
  <span class="ruby-identifier">disallowed</span> = [<span class="ruby-string">&quot;none&quot;</span>, <span class="ruby-string">&quot;auth&quot;</span>, <span class="ruby-string">&quot;login&quot;</span>, <span class="ruby-string">&quot;new_user&quot;</span>, <span class="ruby-string">&quot;load_balancer&quot;</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">disallowed</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">app_name</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppEngineConfigException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;App cannot be called &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-node">&quot;'#{not_allowed}' - this is a reserved name.&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">app_name</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">%r[^[a-z]-]/</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppEngineConfigException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;App name can only contain &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-string">&quot;numeric and lowercase alphabetical characters.&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">app_name</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;-&quot;</span>) <span class="ruby-keyword">and</span> <span class="ruby-identifier">database</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;hypertable&quot;</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppEngineConfigException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;App name cannot contain &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-string">&quot;dashes when Hypertable is the underlying database.&quot;</span>) 
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">app_name</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- validate_app_name-source -->
          
        </div>

        

        
      </div><!-- validate_app_name-method -->

    
      <div id="method-c-wait_for_app_to_start" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">wait_for_app_to_start</span><span
            class="method-args">(head_node_ip, secret, app_name)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="wait_for_app_to_start-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 325</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">wait_for_app_to_start</span>(<span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">secret</span>, <span class="ruby-identifier">app_name</span>)
  <span class="ruby-identifier">acc</span> = <span class="ruby-constant">AppControllerClient</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">secret</span>)

  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Please wait for your app to start up.&quot;</span>
  <span class="ruby-identifier">loop</span> {
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">acc</span>.<span class="ruby-identifier">app_is_running?</span>(<span class="ruby-identifier">app_name</span>)
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span>(<span class="ruby-value">5</span>)
  }

  <span class="ruby-identifier">url_suffix</span> = <span class="ruby-node">&quot;/apps/#{app_name}&quot;</span>
  <span class="ruby-identifier">url</span> = <span class="ruby-node">&quot;http://#{head_node_ip}#{url_suffix}&quot;</span>
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;\nYour app can be reached at the following URL: #{url}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- wait_for_app_to_start-source -->
          
        </div>

        

        
      </div><!-- wait_for_app_to_start-method -->

    
      <div id="method-c-wait_for_nodes_to_load" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">wait_for_nodes_to_load</span><span
            class="method-args">(head_node_ip, secret)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="wait_for_nodes_to_load-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 307</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">wait_for_nodes_to_load</span>(<span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">secret</span>)
  <span class="ruby-identifier">head_acc</span> = <span class="ruby-constant">AppControllerClient</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">secret</span>)
  
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Please wait for AppScale to finish starting up.&quot;</span>
  <span class="ruby-identifier">all_ips</span> = <span class="ruby-identifier">head_acc</span>.<span class="ruby-identifier">get_all_public_ips</span>()
  <span class="ruby-identifier">loop</span> {
    <span class="ruby-identifier">done_starting</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">all_ips</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ip</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">acc</span> = <span class="ruby-constant">AppControllerClient</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">ip</span>, <span class="ruby-identifier">secret</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">acc</span>.<span class="ruby-identifier">is_done_initializing?</span>
        <span class="ruby-identifier">done_starting</span> = <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span>
    }
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">done_starting</span>
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span>(<span class="ruby-value">5</span>)
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- wait_for_nodes_to_load-source -->
          
        </div>

        

        
      </div><!-- wait_for_nodes_to_load-method -->

    
      <div id="method-c-wait_until_redirect" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">wait_until_redirect</span><span
            class="method-args">(host, url_suffix)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="wait_until_redirect-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 340</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">wait_until_redirect</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">url_suffix</span>)
  <span class="ruby-identifier">uri</span> = <span class="ruby-node">&quot;http://#{host}#{url_suffix}&quot;</span>
  <span class="ruby-identifier">loop</span> {
    <span class="ruby-identifier">response</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">response</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">get_response</span>(<span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">uri</span>))
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ECONNREFUSED</span>, <span class="ruby-constant">EOFError</span>
      <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span>(<span class="ruby-value">1</span>)
      <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-identifier">e</span>
    <span class="ruby-keyword">end</span>
    
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">response</span>[<span class="ruby-string">'location'</span>] <span class="ruby-operator">!=</span> <span class="ruby-node">&quot;http://#{host}/status&quot;</span>
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span>(<span class="ruby-value">1</span>)
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- wait_until_redirect-source -->
          
        </div>

        

        
      </div><!-- wait_until_redirect-method -->

    
      <div id="method-c-warn_on_large_app_size" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">warn_on_large_app_size</span><span
            class="method-args">(fullpath)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="warn_on_large_app_size-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 903</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">warn_on_large_app_size</span>(<span class="ruby-identifier">fullpath</span>)
  <span class="ruby-identifier">size</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">size</span>(<span class="ruby-identifier">fullpath</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">MAX_FILE_SIZE</span>
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Warning: Your application is large enough that it may take a while to upload.&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- warn_on_large_app_size-source -->
          
        </div>

        

        
      </div><!-- warn_on_large_app_size-method -->

    
      <div id="method-c-write_and_copy_node_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">write_and_copy_node_file</span><span
            class="method-args">(options, node_layout, head_node_result)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="write_and_copy_node_file-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 812</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">write_and_copy_node_file</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">node_layout</span>, <span class="ruby-identifier">head_node_result</span>)
  <span class="ruby-identifier">keyname</span> = <span class="ruby-identifier">options</span>[<span class="ruby-string">'keyname'</span>]
  <span class="ruby-identifier">head_node_ip</span> = <span class="ruby-identifier">head_node_result</span>[<span class="ruby-value">:head_node_ip</span>]

  <span class="ruby-identifier">all_ips</span> = <span class="ruby-identifier">head_node_result</span>[<span class="ruby-value">:acc</span>].<span class="ruby-identifier">get_all_public_ips</span>()
  <span class="ruby-identifier">db_master_ip</span> = <span class="ruby-identifier">node_layout</span>.<span class="ruby-identifier">db_master</span>.<span class="ruby-identifier">id</span>

  <span class="ruby-identifier">locations_yaml</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-node">&quot;~/.appscale/locations-#{keyname}.yaml&quot;</span>)
  <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">write_node_file</span>(<span class="ruby-identifier">head_node_ip</span>,
    <span class="ruby-identifier">head_node_result</span>[<span class="ruby-value">:instance_id</span>], <span class="ruby-identifier">options</span>[<span class="ruby-string">'table'</span>],
    <span class="ruby-identifier">head_node_result</span>[<span class="ruby-value">:secret_key</span>], <span class="ruby-identifier">db_master_ip</span>, <span class="ruby-identifier">all_ips</span>,
    <span class="ruby-identifier">options</span>[<span class="ruby-string">'infrastructure'</span>], <span class="ruby-identifier">locations_yaml</span>)
  <span class="ruby-identifier">remote_locations_file</span> = <span class="ruby-node">&quot;/root/.appscale/locations-#{keyname}.yaml&quot;</span>
  <span class="ruby-constant">CommonFunctions</span>.<span class="ruby-identifier">scp_file</span>(<span class="ruby-identifier">locations_yaml</span>, <span class="ruby-identifier">remote_locations_file</span>,
    <span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">head_node_result</span>[<span class="ruby-value">:true_key</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- write_and_copy_node_file-source -->
          
        </div>

        

        
      </div><!-- write_and_copy_node_file-method -->

    
      <div id="method-c-write_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">write_file</span><span
            class="method-args">(location, contents)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>A convenience function that can be used to write a string to a file.</p>
          

          
          <div class="method-source-code" id="write_file-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 85</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">write_file</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">contents</span>)
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">location</span>, <span class="ruby-string">&quot;w+&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">contents</span>) }
<span class="ruby-keyword">end</span></pre>
          </div><!-- write_file-source -->
          
        </div>

        

        
      </div><!-- write_file-method -->

    
      <div id="method-c-write_node_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">write_node_file</span><span
            class="method-args">(head_node_ip, instance_id, table, secret, db_master, ips, infrastructure, locations_yaml)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="write_node_file-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 830</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">write_node_file</span>(<span class="ruby-identifier">head_node_ip</span>, <span class="ruby-identifier">instance_id</span>, <span class="ruby-identifier">table</span>, <span class="ruby-identifier">secret</span>, <span class="ruby-identifier">db_master</span>,
  <span class="ruby-identifier">ips</span>, <span class="ruby-identifier">infrastructure</span>, <span class="ruby-identifier">locations_yaml</span>)

  <span class="ruby-identifier">infrastructure</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;xen&quot;</span>
  <span class="ruby-identifier">tree</span> = { <span class="ruby-value">:load_balancer</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">head_node_ip</span>, <span class="ruby-value">:instance_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">instance_id</span> , 
           <span class="ruby-value">:table</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">table</span>, <span class="ruby-value">:shadow</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">head_node_ip</span>, 
           <span class="ruby-value">:secret</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">secret</span> , <span class="ruby-value">:db_master</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">db_master</span>,
           <span class="ruby-value">:ips</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ips</span> , <span class="ruby-value">:infrastructure</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">infrastructure</span> }
  <span class="ruby-identifier">loc_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">locations_yaml</span>)
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">loc_path</span>, <span class="ruby-string">&quot;w&quot;</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">dump</span>(<span class="ruby-identifier">tree</span>, <span class="ruby-identifier">file</span>)}
<span class="ruby-keyword">end</span></pre>
          </div><!-- write_node_file-source -->
          
        </div>

        

        
      </div><!-- write_node_file-method -->

    
      <div id="method-c-write_nodes_json" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">write_nodes_json</span><span
            class="method-args">(new_role_info, keyname)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Writes the given JSON to the ~/.appscale directory so that we can read it
later and determine what nodes run what services.</p>
          

          
          <div class="method-source-code" id="write_nodes_json-source">
            <pre><span class="ruby-comment"># File lib/common_functions.rb, line 806</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">write_nodes_json</span>(<span class="ruby-identifier">new_role_info</span>, <span class="ruby-identifier">keyname</span>)
  <span class="ruby-identifier">filename</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-node">&quot;~/.appscale/locations-#{keyname}.json&quot;</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">write_file</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">dump</span>(<span class="ruby-identifier">new_role_info</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- write_nodes_json-source -->
          
        </div>

        

        
      </div><!-- write_nodes_json-method -->

    
    </section><!-- public-class-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

